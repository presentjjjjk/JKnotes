# 密度泛函理论

在前面我们已经介绍了使用HF方法求解总波函数并对多电子系统的性质进行描述,然而,HF方法缺少电子关联,我们需要使用一些补丁方法提升HF的精度,随着电子关联的逐渐完善,所需要的计算资源也会急剧提升.

密度泛函理论就另辟蹊径,它不考虑求解真实的总波函数,而是追求去求解电子密度. 对于N个电子,总波函数涉及到$3N$个变量,我们需要求解含有3N个变量的方程,而密度泛函理论指出,我们只需要求解电子密度的3个分量,也就是我们理想情况下只需要求解3个变量的方程.

那么,为什么可以这么做呢,也就是说,为什么我们只需要求解电子密度?

## Hohenberg-Kohn 定理

Walter Kohn和Lu Jeu Sham告诉我们,对于任何的多电子系统,其能量以及其他所有表观性质可以被电子密度唯一确定,也就是说,能量是电子密度的泛函,并且,对任意一个猜测的电子密度,其满足变分原理:

$$
E(\mathbf{\rho})\ge E_0
$$

上述条件其实告诉我们,体系的哈密顿量可以写成电子密度的泛函:

$$
H(\rho)=T({\rho})+V({\rho})
$$

但是,如何找到这个泛函关系是异常困难的,我们已知的办法就只有通过波函数去求解体系的总能量,所以,我们放宽条件,用波函数和电子密度共同描述体系,那这样,一个哈密顿算符就是可描述的,可以求解体系的单电子波函数(分子轨道).

这样,每个分子的动能信息是可以被单电子波函数描述的,然后其他的总势能是可以被电子密度描述的,由此,总能量就能被我们全部描述.


## Kohn-Sham 方程

这个方程实际上就是单电子的本征方程:

$$
\left[-\frac{1}{2}\nabla^2+V_i({r})+V_{iH}({r})+V_{iXC}({r}) \right]\psi_i({r})=\varepsilon_i \psi_i({r})
$$

第一个势能项就是电子-核势能,我们可以比较轻松的写出:

$$
V_i({r})=\sum_{A}\frac{-Z_A}{|r_i-R_A|}
$$

第二个势能就是我们在推导HF的过程中得到的库伦积分势能(注意在原子单位制中e被设定为1,所以电子密度就是概率密度),代表一部分电子关联的能量,也就是电子排斥势能:

$$
V_{iH}({r})=\int  \frac{\rho({r_1})}{|r-r_1|}dr_1
$$

## 交换关联泛函

当然,我们知道上述的电子关联是不完整的,所以HF方法才会有组态相关的补充,以及我们知道,为了满足体系反对称性,量子领域还会引入交换势能,上述的这些势能都比较难以写出,所以我们把它们合并到一项中去,称作交换关联势能$V_{XC}$

显然,为了求解K-S方程,我们需要知道交换关联泛函的具体形式,这显然是难以做到的,但是DFT之于HF精确的地方在于,我们可以经验性的去选定某些泛函去代替交换关联泛函用于求解单电子波函数.

例如LDA,这是由均匀电子气导出的交换关联泛函,在均匀电子气的情况下,电子关联是好处理的,然后将实际体系中的每一处电子云都用电子密度不同的均匀电子气近似,这样就解决了泛函的问题.

还有比上述更加精确的泛函,如GGA,GGA不仅考虑电子密度，还考虑密度的梯度，从而提高对非均匀电子气的描述。

$$
V_{XC}=V_{XC}(\mathbf{\rho},\mathbf{\nabla \rho})
$$

在绝大多数情况下,GGA的表现确实是要优于LDA,因为它包含了更多电子信息,这是理所应当的,然而事实却并非这样,选择哪种泛函更多的是基于经验的.

常见的泛函还有杂化泛函,由于我们在HF中已经导出了交换势能,所以不妨就使用HF的交换势能,关联势能再另外寻找(例如使用GGA和HF的交换能线性组合)

\[
E_{\text{XC}}^{\text{hybrid}}[\rho] = E_{\text{XC}}^{\text{GGA}}[\rho] + \alpha E_{\text{X}}^{\text{HF}}
\]

## 算法流程

我感觉和HF的流程没什么区别,唯一的差别是更多的量用电子密度表示,以及在电子的交换关联势能处做出了改进.

相较于HF对系数矩阵初值的严格性(要求正交归一,通常采用hartree算符的本征向量),电子密度初值的设置反倒没有那么严格,推荐使用接近物理实际的电子密度分布.

- 设置电子密度初值
- 选定交换关联泛函
- 求解Kohn-Sham方程,得到单电子波函数
- 根据下式更新电子密度(由于已经充分考虑交换关联,所以不需要总波函数,只需要各个波函数叠加即可):
  
$$
\rho^{(n+1)}(r)=\sum_i |\psi_i^{(n)}|^2
$$

- 回到第三步,反复迭代直到电子密度不再发生变化为止
- 求解总能量
  
首先,求解体系的动能,这等价于所有电子的动能相加,显然电子的轨道波函数不是动能算符的本征函数,所以要求一下期望:

$$
T_{total}\equiv \sum_i\langle\psi_i|\hat{T}|\psi_i\rangle=\sum_i -\frac{1}{2}\int dr \psi_i^*(r)\nabla^2\psi^*(r)
$$

电子的电子-核相互作用势能为:

$$
V_{total}=\sum_i\int dr \psi_i^*(r) \frac{-Z_A}{|r-R_A|}\psi_i(r)=\int dr \sum_i \psi_i^*(r)\psi_i(r)\sum_i \frac{-Z_A}{|r-R_A|}=\int dr \rho(r) V_{e-N}(r)
$$

总库伦势能为:

$$
V_{Htotal}=\frac{1}{2}\sum_i\int\int  \psi_i^*(r)\frac{\rho({r_1})}{|r-r_1|}\psi_i(r)dr_1=\frac{1}{2}\iint \frac{\rho(r_1)\rho(r)}{|r-r_1|}drdr_1
$$

注意到前面多了一个1/2,因为库伦势能是单电子和其余所有电子的排斥作用,遍历所有电子求势能的时候,电子会被重复计数.

还剩最后一项交换关联势能,这显然可以用势能描述,综上所述,所有的势能都能被电子密度描述,动能能被单电子波函数描述,这样我们就不需要总波函数,也就不需要系数矩阵,不需要密度矩阵就可以求出能量,在这一步就已经可以体现出DFT在大规模运算中的优点了.

## DFT的缺陷

上面说了那么多DFT的优点,自然要谈谈他的缺陷.

首先,DFT的交换关联泛函是一个经验性的参数性的结果,选择什么样的泛函完全是基于已知计算结果的经验操作,这是一个相当可悲的事情.

其次,相较于传统的自洽场理论,DFT的计算精度难以继续提升,在自洽场中,我们可以通过不断往上加电子关联去逐渐逼近完全组态相关,最终得到一个相对精确的解,而DFT的框架设计就意味着我们很难找到方向去提升其计算精度,所以在一些高精度的计算场合,DFT往往是不被采用的.


